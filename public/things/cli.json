{
  "layout": "blog",
  "name": "linux",
  "notes": "# Unix Tools\n\n### ü§ó User Management\n```\n# Change username\nusermod -l new old\n```\n\n### üìÅ File Management\n```\ntar -xzvf (uncompress gz)\ntar -xjvf (uncompress bz2)\n\ntar -czvf router.apkovl.tar.gz router/ (compress to gz)\n```\n\nWhen filesystem is mounted under SMB, even root will have trouble settings correct permissions through the sudo command. **You can get around this problem by specifying ```--no-same-owner```**\n\n```\ntar xzvf stuff.tar.gz --no-same-owner -C /media/dest\n```\n### üíæ Disk Management\n```\ndf -h # human readable disk usage\nfdisk\nparted\n```\n\n### üíª Hardware Management\n```\nlsmod # list loaded kernel modules\n\n# blacklisting kernel modules\nvim /etc/modprobe.d/blacklist.conf\n\n# see installed firmware\ncd /lib/firmware/*\n```\n\n### üåê LAN Management\n```\n# All saved / bootable interfaces\ncat /etc/network/interfaces\n\n# Example\n```\nauto lo\niface lo inet loopback\n\niface eth0 inet manual\n\nauto-hotplug wlan0\n    iface wlan0 inet dhcp\n    wpa-roam /etc/wpa_supplicant/wpa_supplicant.conf\n```\n# All current available interfaces\nls /sys/class/net\n\n# Probe master mode for interface\niwconfig wlan1 mode master\n```\n\n#### TIL wtf a subnet mask actually is\nOnly change within the range of numbers not AND'ed by that value\n```\nip = 192.168.5.255/24 #CIDR Notation\n\nbase = 192.168.5.255\n\nsubnet-mask = 255.255.255.000\n \n     11000000.10101000.00000111.01111111\n AND 11111111.11111111.11111111.00000000\n     ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî\n     1100000.00001010.00000111.00000000\n```\n\n##### Configuring A DHCP Service\n```\nsudo apt install isc-dhcp-server\n# or\nsudo apk add dhcp-server-vanilla dhcp-openrc \n```\n- Modify Interfaces\n\n- Modify dhcpd.conf\nhttps://www.cyberciti.biz/faq/debian-ubuntu-linux-setting-wireless-access-point/\n\n[https://wiki.alpinelinux.org/wiki/Small_Office_Services#Install_and_Configure_DHCP_and_DNS_services](https://wiki.alpinelinux.org/wiki/Small_Office_Services#Install_and_Configure_DHCP_and_DNS_services)\n\n[https://wiki.debian.org/NetworkConfiguration#Manual_config](https://wiki.debian.org/NetworkConfiguration#Manual_config)\n\n### üåé WAN Management\n##### SSH Reverse Tunneling\n```\nssh ‚Äìf ‚ÄìN ‚ÄìT ‚ÄìR 2222:localhost:22 username@everythingcli.org\n```\n - -f: tells the SSH to background itself after it authenticates, saving you time by not having to run something on the remote server for the tunnel to remain alive.\n - -N: if all you need is to create a tunnel without running any remote commands then include this option to save resources.\n - -T: useful to disable pseudo-tty allocation, which is fitting if you are not trying to create an interactive shell.\n```\nautossh -M 0 -o \"ServerAliveInterval 30\" -o \"ServerAliveCountMax 3\"\n```\n - autossh for auto reconnect on intervals\nÔªø\n```\nautossh -M 0 -o \"ServerAliveInterval 30\" -o \"ServerAliveCountMax 3\" ‚Äìf ‚ÄìN ‚ÄìT ‚ÄìR 2222:localhost:22 cytopia@everythingcli.org\n```\n\n\n\n### üîë Auth / Logging\n```\nlast\n> user      pts/4        108.210.178.151  Sun Jan 26 04:05   still \n> logged in\n...\n\nvim /var/log/auth.log\n> Jan 24 03:07:47 hostname sshd[14435]: Invalid user admin from 141.98.81.37 port 42579\n...\n\ncat /etc/passwd # for user lists and shell defaults\n```\n### üå± Init Systems\n\n### Open RC\n - [They are finally writing this üëè  - https://wiki.alpinelinux.org/wiki/Writing_Init_Scripts](https://wiki.alpinelinux.org/wiki/Writing_Init_Scripts)\n - [https://wiki.gentoo.org/wiki/OpenRC](https://wiki.gentoo.org/wiki/OpenRC)\n - [https://wiki.alpinelinux.org/wiki/Alpine_Linux_Init_System](https://wiki.alpinelinux.org/wiki/Alpine_Linux_Init_System)\n\n#### Commands\n```\nrc-update add <service> <runlevel>\nrc-update del <service> <runlevel>\nrc-service <service> <start stop restart>\nrc-status\nrc <runlevel> \n``` \n\n#### Script Example\n - init scripts in /etc/init.d\n - update-rc.d does not work fine if there is no specific comment block in the start script that looks like this:\n - On Raspbian Buster (v10) #! /bin/sh must appear right before the BEGIN INIT INFO block.\n```\n#!/sbin/openrc-run\n\n### BEGIN INIT INFO\n# Provides: reverse-ssh\n# Required-Start:\n# Required-Stop:\n# Default-Start: 2 3 4 5\n# Default-Stop: 0 1 6\n# Short-Description: Start reverse ssh at boot time\n# Description: Start reverse ssh at boot time.\n### END INIT INFO\n# . /etc/init.d/functions.sh\n\ndepend(){\n        need sshd\n}\n\nstart() {\n        echo \"Opening reverse shell.\"\n        /usr/bin/autossh -M 0 -o \"ServerAliveInterval 30\" -o \"ServerAliveCountMax 3\" -f -N -R 8000:localhost:22 vpn@192.168.0.0\n}\n```\n\n### Systemd\n\n#### Commands\n```\nsudo service <title> start\n```\n\n#### Script example\n```\n#!/bin/sh\nÔªø\n#ssh -R 8000:localhost:22 vpn@167.172.148.6\nÔªø\n### BEGIN INIT INFO\n# Provides: new-reverse-ssh\n# Required-Start: \n# Required-Stop: \n# Default-Start: 2 3 4 5\n# Default-Stop: 0 1 6\n# Short-Description: Start reverse ssh at boot time\n# Description: Start reverse ssh at boot time. \n### END INIT INFO \nÔªø\nstart() {\n        echo \"Opening reverse shell.\"\n\t/usr/bin/autossh -M 0 -o \"ServerAliveInterval 30\" -o \"ServerAliveCountMax 3\" -f -N -R 8000:localhost:22 vpn@167.172.148.6\n}\nÔªø\ncase \"$1\" in\n  start)\n\tstart;;\n  *)\n        echo \"Usage: ${0:-} {start|stop|status|restart|reload|force-reload}\" >&2\n        exit 1;;\nesac\nÔªø\n```\n\n\nüì° Networking\n\n* https://forum.openwrt.org/t/solved-how-to-access-the-modem-which-is-in-bridge-mode/6773/11\n* https://openwrt.org/docs/guide-user/network/wan/dmz-based-bridge-mode\n* https://openwrt.org/docs/guide-user/network/wan/bridge-mode\n* https://openwrt.org/docs/guide-user/network/switch_router_gateway_and_nat\n* https://openwrt.org/docs/guide-user/network/openwrt_as_routerdevice\n* https://openwrt.org/docs/guide-user/network/openwrt_as_clientdevice\n\n\n##### References\n - [https://www.linux.com/tutorials/managing-linux-daemons-init-scripts/](https://www.linux.com/tutorials/managing-linux-daemons-init-scripts/)\n - [https://www.everythingcli.org/ssh-tunnelling-for-fun-and-profit-autossh/](https://www.everythingcli.org/ssh-tunnelling-for-fun-and-profit-autossh/)\n - [https://askubuntu.com/questions/936728/how-to-keep-ssh-connection-alive](https://askubuntu.com/questions/936728/how-to-keep-ssh-connection-alive)\n - [https://unix.stackexchange.com/questions/102918/service-to-start-on-boot-doesnt-work-with-update-rc-d-command](https://unix.stackexchange.com/questions/102918/service-to-start-on-boot-doesnt-work-with-update-rc-d-command)"
}